!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("tslib"),require("@angular/core"),require("rxjs/operators"),require("@angular/common/http"),require("rxjs"),require("@ngrx/entity"),require("@ngrx/store"),require("@ngrx/effects")):"function"==typeof define&&define.amd?define("ngrx-data",["exports","tslib","@angular/core","rxjs/operators","@angular/common/http","rxjs","@ngrx/entity","@ngrx/store","@ngrx/effects"],e):e(t["ngrx-data"]={},t.tslib,t.ng.core,t.Rx.Observable.prototype,t.ng.common.http,t.rxjs,t.ngrx.entity,t.ngrx.store,t.ngrx.effects)}(this,function(t,h,c,d,n,l,s,y,o){"use strict";var r=function(){function t(){}return t.prototype.create=function(t,e,r,n){var i="string"==typeof t?h.__assign({},n||{},{entityName:t,entityOp:e,data:r}):t;return this.createCore(i)},t.prototype.createCore=function(t){var e=t.entityName,r=t.entityOp,n=t.tag;if(!e)throw new Error("Missing entity name for new action");if(null==r)throw new Error("Missing EntityOp for new action");return{type:this.formatActionType(r,n||e),payload:t}},t.prototype.createFromAction=function(t,e){return this.create(h.__assign({},t.payload,e))},t.prototype.formatActionType=function(t,e){return"["+e+"] "+t},t.decorators=[{type:c.Injectable}],t}(),u=function(){function t(t,e){this.entityName=t,this.selectId=e}return t.prototype.mustBeEntity=function(t){var e=this.extractData(t);e||this.throwError(t,"should have a single entity.");var r=this.selectId(e);return this.isNotKeyType(r)&&this.throwError(t,"has a missing or invalid entity key (id)"),e},t.prototype.mustBeEntities=function(i){var a=this,t=this.extractData(i);return Array.isArray(t)||this.throwError(i,"should be an array of entities"),t.forEach(function(t,e){var r=a.selectId(t);if(a.isNotKeyType(r)){var n=", item "+(e+1)+", does not have a valid entity key (id)";a.throwError(i,n)}}),t},t.prototype.mustBeKey=function(t){var e=this.extractData(t);if(!e)throw new Error("should be a single entity key");if(this.isNotKeyType(e))throw new Error("is not a valid key (id)");return e},t.prototype.mustBeKeys=function(n){var i=this,t=this.extractData(n);return Array.isArray(t)||this.throwError(n,"should be an array of entity keys (id)"),t.forEach(function(t,e){if(i.isNotKeyType(t)){var r=i.entityName+" ', item "+(e+1)+", is not a valid entity key (id)";i.throwError(n,r)}}),t},t.prototype.mustBeUpdate=function(t){var e=this.extractData(t);e||this.throwError(t,"should be a single entity update");var r=e.id,n=e.changes,i=this.selectId(n);return(this.isNotKeyType(r)||this.isNotKeyType(i))&&this.throwError(t,"has a missing or invalid entity key (id)"),e},t.prototype.mustBeUpdates=function(a){var o=this,t=this.extractData(a);return Array.isArray(t)||this.throwError(a,"should be an array of entity updates"),t.forEach(function(t,e){var r=t.id,n=t.changes,i=o.selectId(n);(o.isNotKeyType(r)||o.isNotKeyType(i))&&o.throwError(a,", item "+(e+1)+", has a missing or invalid entity key (id)")}),t},t.prototype.mustBeUpdateResponse=function(t){var e=this.extractData(t);e||this.throwError(t,"should be a single entity update");var r=e.id,n=e.changes,i=this.selectId(n);return(this.isNotKeyType(r)||this.isNotKeyType(i))&&this.throwError(t,"has a missing or invalid entity key (id)"),e},t.prototype.mustBeUpdateResponses=function(a){var o=this,t=this.extractData(a);return Array.isArray(t)||this.throwError(a,"should be an array of entity updates"),t.forEach(function(t,e){var r=t.id,n=t.changes,i=o.selectId(n);(o.isNotKeyType(r)||o.isNotKeyType(i))&&o.throwError(a,", item "+(e+1)+", has a missing or invalid entity key (id)")}),t},t.prototype.extractData=function(t){return t.payload&&t.payload.data},t.prototype.isNotKeyType=function(t){return"string"!=typeof t&&"number"!=typeof t},t.prototype.throwError=function(t,e){throw new Error(this.entityName+' EntityAction guard for "'+t.type+'": payload '+e)},t}();function p(t){return null==t?undefined:t.id}function i(t){if(null==t)return[];if(Array.isArray(t[0])){var e=h.__read(t),r=e[0],n=e.slice(1);t=h.__spread(r,n)}return t}function g(r){return r=r||p,function(t){var e=r(t);if(null==e)throw new Error("Primary key may not be null/undefined.");return t&&{id:e,changes:t}}}function E(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=i(t);switch(r.length){case 0:return d.filter(function(t){return t.payload&&null!=t.payload.entityOp});case 1:var n=r[0];return d.filter(function(t){return t.payload&&n===t.payload.entityOp});default:return d.filter(function(t){var e=t.payload&&t.payload.entityOp;return e&&r.some(function(t){return t===e})})}}function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=i(t);switch(r.length){case 0:return d.filter(function(t){return t.payload&&null!=t.payload.entityName});case 1:var n=r[0];return d.filter(function(t){return t.payload&&n===t.payload.entityName});default:return d.filter(function(t){var e=t.payload&&t.payload.entityName;return e&&r.some(function(t){return t===e})})}}var f={Add:"Add",Delete:"Delete",Update:"Update",Upsert:"Upsert"},a=function(){function t(){}return t.prototype.add=function(t,e){return e=Array.isArray(e)?e:e?[e]:[],{entityName:t,op:f.Add,entities:e}},t.prototype["delete"]=function(t,e){var r=Array.isArray(e)?e:e?[e]:[];return{entityName:t,op:f.Delete,entities:r}},t.prototype.update=function(t,e){return e=Array.isArray(e)?e:e?[e]:[],{entityName:t,op:f.Update,entities:e}},t.prototype.upsert=function(t,e){return e=Array.isArray(e)?e:e?[e]:[],{entityName:t,op:f.Upsert,entities:e}},t}(),S=new a;function v(t){var e=(t=t&&t.changes?t:{changes:[]}).changes.filter(function(t){return null!=t&&t.entities&&0<t.entities.length});return h.__assign({},t,{changes:e})}var _={IgnoreChanges:0,PreserveChanges:1,OverwriteChanges:2};_[_.IgnoreChanges]="IgnoreChanges",_[_.PreserveChanges]="PreserveChanges",_[_.OverwriteChanges]="OverwriteChanges";var m={CLEAR_COLLECTIONS:"ngrx-data/entity-cache/clear-collections",LOAD_COLLECTIONS:"ngrx-data/entity-cache/load-collections",MERGE_QUERY_SET:"ngrx-data/entity-cache/merge-query-set",SET_ENTITY_CACHE:"ngrx-data/entity-cache/set-cache",SAVE_ENTITIES:"ngrx-data/entity-cache/save-entities",SAVE_ENTITIES_CANCEL:"ngrx-data/entity-cache/save-entities-cancel",SAVE_ENTITIES_CANCELED:"ngrx-data/entity-cache/save-entities-canceled",SAVE_ENTITIES_ERROR:"ngrx-data/entity-cache/save-entities-error",SAVE_ENTITIES_SUCCESS:"ngrx-data/entity-cache/save-entities-success"},A=function(t,e){this.type=m.CLEAR_COLLECTIONS,this.payload={collections:t,tag:e}},C=function(t,e){this.type=m.LOAD_COLLECTIONS,this.payload={collections:t,tag:e}},O=function(t,e,r){this.type=m.MERGE_QUERY_SET,this.payload={querySet:t,mergeStrategy:null===e?_.PreserveChanges:e,tag:r}},D=function(t,e){this.cache=t,this.type=m.SET_ENTITY_CACHE,this.payload={cache:t,tag:e}},T=function(t,e,r){this.type=m.SAVE_ENTITIES,r=r||{},t&&(t.tag=t.tag||r.tag),this.payload=h.__assign({changeSet:t,url:e},r,{tag:t.tag})},R=function(t,e,r,n){this.type=m.SAVE_ENTITIES_CANCEL,this.payload={correlationId:t,reason:e,entityNames:r,tag:n}},N=function(t,e,r){this.type=m.SAVE_ENTITIES_CANCEL,this.payload={correlationId:t,reason:e,tag:r}},M=function(t,e){this.type=m.SAVE_ENTITIES_ERROR;var r=e.payload.correlationId;this.payload={error:t,originalAction:e,correlationId:r}},U=function(t,e,r){this.type=m.SAVE_ENTITIES_SUCCESS,r=r||{},t&&(t.tag=t.tag||r.tag),this.payload=h.__assign({changeSet:t,url:e},r,{tag:t.tag})},I={CANCEL_PERSIST:"ngrx-data/cancel-persist",CANCELED_PERSIST:"ngrx-data/canceled-persist",QUERY_ALL:"ngrx-data/query-all",QUERY_ALL_SUCCESS:"ngrx-data/query-all/success",QUERY_ALL_ERROR:"ngrx-data/query-all/error",QUERY_LOAD:"ngrx-data/query-load",QUERY_LOAD_SUCCESS:"ngrx-data/query-load/success",QUERY_LOAD_ERROR:"ngrx-data/query-load/error",QUERY_MANY:"ngrx-data/query-many",QUERY_MANY_SUCCESS:"ngrx-data/query-many/success",QUERY_MANY_ERROR:"ngrx-data/query-many/error",QUERY_BY_KEY:"ngrx-data/query-by-key",QUERY_BY_KEY_SUCCESS:"ngrx-data/query-by-key/success",QUERY_BY_KEY_ERROR:"ngrx-data/query-by-key/error",SAVE_ADD_MANY:"ngrx-data/save/add-many",SAVE_ADD_MANY_ERROR:"ngrx-data/save/add-many/error",SAVE_ADD_MANY_SUCCESS:"ngrx-data/save/add-many/success",SAVE_ADD_ONE:"ngrx-data/save/add-one",SAVE_ADD_ONE_ERROR:"ngrx-data/save/add-one/error",SAVE_ADD_ONE_SUCCESS:"ngrx-data/save/add-one/success",SAVE_DELETE_MANY:"ngrx-data/save/delete-many",SAVE_DELETE_MANY_SUCCESS:"ngrx-data/save/delete-many/success",SAVE_DELETE_MANY_ERROR:"ngrx-data/save/delete-many/error",SAVE_DELETE_ONE:"ngrx-data/save/delete-one",SAVE_DELETE_ONE_SUCCESS:"ngrx-data/save/delete-one/success",SAVE_DELETE_ONE_ERROR:"ngrx-data/save/delete-one/error",SAVE_UPDATE_MANY:"ngrx-data/save/update-many",SAVE_UPDATE_MANY_SUCCESS:"ngrx-data/save/update-many/success",SAVE_UPDATE_MANY_ERROR:"ngrx-data/save/update-many/error",SAVE_UPDATE_ONE:"ngrx-data/save/update-one",SAVE_UPDATE_ONE_SUCCESS:"ngrx-data/save/update-one/success",SAVE_UPDATE_ONE_ERROR:"ngrx-data/save/update-one/error",SAVE_UPSERT_MANY:"ngrx-data/save/upsert-many",SAVE_UPSERT_MANY_SUCCESS:"ngrx-data/save/upsert-many/success",SAVE_UPSERT_MANY_ERROR:"ngrx-data/save/upsert-many/error",SAVE_UPSERT_ONE:"ngrx-data/save/upsert-one",SAVE_UPSERT_ONE_SUCCESS:"ngrx-data/save/upsert-one/success",SAVE_UPSERT_ONE_ERROR:"ngrx-data/save/upsert-one/error",ADD_ALL:"ngrx-data/add-all",ADD_MANY:"ngrx-data/add-many",ADD_ONE:"ngrx-data/add-one",REMOVE_ALL:"ngrx-data/remove-all",REMOVE_MANY:"ngrx-data/remove-many",REMOVE_ONE:"ngrx-data/remove-one",UPDATE_MANY:"ngrx-data/update-many",UPDATE_ONE:"ngrx-data/update-one",UPSERT_MANY:"ngrx-data/upsert-many",UPSERT_ONE:"ngrx-data/upsert-one",COMMIT_ALL:"ngrx-data/commit-all",COMMIT_MANY:"ngrx-data/commit-many",COMMIT_ONE:"ngrx-data/commit-one",UNDO_ALL:"ngrx-data/undo-all",UNDO_MANY:"ngrx-data/undo-many",UNDO_ONE:"ngrx-data/undo-one",SET_CHANGE_STATE:"ngrx-data/set-change-state",SET_COLLECTION:"ngrx-data/set-collection",SET_FILTER:"ngrx-data/set-filter",SET_LOADED:"ngrx-data/set-loaded",SET_LOADING:"ngrx-data/set-loading"},x="/success",L="/error";function b(t){return t+L}function k(t){return t+x}var w=function(t,e){this.error=t,this.requestData=e,this.message=t.error&&t.error.message||(t.message||t.body&&t.body.error||t).toString()},Y=function(){},P=function(){},V=new c.InjectionToken("ngrx-data/plural-names"),F=function(){},$=function(){},j=function(){},B=function(){function t(t){this.pluralizer=t,this.knownHttpResourceUrls={}}return t.prototype.getResourceUrls=function(t,e){var r,n=this.knownHttpResourceUrls[t];if(!n){var i=Q(e);n={entityResourceUrl:(i+"/"+t+"/").toLowerCase(),collectionResourceUrl:(i+"/"+this.pluralizer.pluralize(t)+"/").toLowerCase()},this.registerHttpResourceUrls(((r={})[t]=n,r))}return n},t.prototype.entityResource=function(t,e){return this.getResourceUrls(t,e).entityResourceUrl},t.prototype.collectionResource=function(t,e){return this.getResourceUrls(t,e).collectionResourceUrl},t.prototype.registerHttpResourceUrls=function(t){this.knownHttpResourceUrls=h.__assign({},this.knownHttpResourceUrls,t||{})},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:F}]},t}();function Q(t){return t.replace(/^[\/\s]+|[\/\s]+$/g,"")}var q=function(){function t(t,e,r,n){this.http=e,this.httpUrlGenerator=r,this.getDelay=0,this.saveDelay=0,this.timeout=0,this._name=t+" DefaultDataService",this.entityName=t;var i=n||{},a=i.root,o=void 0===a?"api":a,s=i.delete404OK,c=void 0===s||s,u=i.getDelay,p=void 0===u?0:u,h=i.saveDelay,y=void 0===h?0:h,d=i.timeout,l=void 0===d?0:d;this.delete404OK=c,this.entityUrl=r.entityResource(t,o),this.entitiesUrl=r.collectionResource(t,o),this.getDelay=p,this.saveDelay=y,this.timeout=l}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),t.prototype.add=function(t){var e=t||new Error('No "'+this.entityName+'" entity to add');return this.execute("POST",this.entityUrl,e)},t.prototype["delete"]=function(e){var t;return null==e&&(t=new Error('No "'+this.entityName+'" key to delete')),this.execute("DELETE",this.entityUrl+e,t).pipe(d.map(function(t){return e}))},t.prototype.getAll=function(){return this.execute("GET",this.entitiesUrl)},t.prototype.getById=function(t){var e;return null==t&&(e=new Error('No "'+this.entityName+'" key to get')),this.execute("GET",this.entityUrl+t,e)},t.prototype.getWithQuery=function(t){var e="string"==typeof t?{fromString:t}:{fromObject:t},r=new n.HttpParams(e);return this.execute("GET",this.entitiesUrl,undefined,{params:r})},t.prototype.update=function(t){var e=t&&t.id,r=null==e?new Error('No "'+this.entityName+'" update data or id'):t.changes;return this.execute("PUT",this.entityUrl+e,r)},t.prototype.upsert=function(t){var e=t||new Error('No "'+this.entityName+'" entity to upsert');return this.execute("POST",this.entityUrl,e)},t.prototype.execute=function(t,e,r,n){var i,a={method:t,url:e,data:r,options:n};if(r instanceof Error)return this.handleError(a)(r);switch(t){case"DELETE":i=this.http["delete"](e,n),this.saveDelay&&(i=i.pipe(d.delay(this.saveDelay)));break;case"GET":i=this.http.get(e,n),this.getDelay&&(i=i.pipe(d.delay(this.getDelay)));break;case"POST":i=this.http.post(e,r,n),this.saveDelay&&(i=i.pipe(d.delay(this.saveDelay)));break;case"PUT":i=this.http.put(e,r,n),this.saveDelay&&(i=i.pipe(d.delay(this.saveDelay)));break;default:var o=new Error("Unimplemented HTTP method, "+t);i=l.throwError(o)}return this.timeout&&(i=i.pipe(d.timeout(this.timeout+this.saveDelay))),i.pipe(d.catchError(this.handleError(a)))},t.prototype.handleError=function(n){var i=this;return function(t){var e=i.handleDelete404(t,n);if(e)return e;var r=new w(t,n);return l.throwError(r)}},t.prototype.handleDelete404=function(t,e){return 404===t.status&&"DELETE"===e.method&&this.delete404OK?l.of({}):undefined},t}(),K=function(){function t(t,e,r){this.http=t,this.httpUrlGenerator=e,r=(this.config=r)||{},e.registerHttpResourceUrls(r.entityHttpResourceUrls)}return t.prototype.create=function(t){return new q(t,this.http,this.httpUrlGenerator,this.config)},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:n.HttpClient},{type:j},{type:Y,decorators:[{type:c.Optional}]}]},t}();function H(t){var e=t.entityName;if(!e)throw new Error("Missing required entityName");t.entityName=e=e.trim();var r=t.selectId||p,n=t.sortComparer=t.sortComparer||!1,i=s.createEntityAdapter({selectId:r,sortComparer:n}),a=t.entityDispatcherOptions||{},o=i.getInitialState(h.__assign({entityName:e,filter:"",loaded:!1,loading:!1,changeState:{}},t.additionalCollectionState||{}));return{entityName:e,entityAdapter:i,entityDispatcherOptions:a,initialState:o,metadata:t,noChangeTracking:!0===t.noChangeTracking,selectId:r,sortComparer:n}}var G=new c.InjectionToken("ngrx-data/entity-metadata"),W=function(){function t(t){var e=this;this.definitions={},t&&t.forEach(function(t){return e.registerMetadataMap(t)})}return t.prototype.getDefinition=function(t,e){void 0===e&&(e=!0),t=t.trim();var r=this.definitions[t];if(!r&&e)throw new Error('No EntityDefinition for entity type "'+t+'".');return r},t.prototype.registerMetadata=function(t){if(t){var e=H(t);this.registerDefinition(e)}},t.prototype.registerMetadataMap=function(e){var r=this;void 0===e&&(e={}),Object.keys(e||{}).forEach(function(t){return r.registerMetadata(h.__assign({entityName:t},e[t]))})},t.prototype.registerDefinition=function(t){this.definitions[t.entityName]=t},t.prototype.registerDefinitions=function(t){Object.assign(this.definitions,t)},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:Array,decorators:[{type:c.Optional},{type:c.Inject,args:[G]}]}]},t}(),z=f.Update,J=function(){function t(t,e,r){this.entityDefinitionService=t,this.http=e,this.idSelectors={},this.saveDelay=0,this.timeout=0;var n=r||{},i=n.saveDelay,a=void 0===i?0:i,o=n.timeout,s=void 0===o?0:o;this.saveDelay=a,this.timeout=s}return t.prototype.saveEntities=function(t,e){var r=this;t=this.filterChangeSet(t),t=this.flattenUpdates(t);var n=this.http.post(e,t).pipe(d.map(function(t){return r.restoreUpdates(t)}),d.catchError(this.handleError({method:"POST",url:e,data:t})));return this.timeout&&(n=n.pipe(d.timeout(this.timeout))),this.saveDelay&&(n=n.pipe(d.delay(this.saveDelay))),n},t.prototype.handleError=function(r){return function(t){var e=new w(t,r);return l.throwError(e)}},t.prototype.filterChangeSet=function(t){return v(t)},t.prototype.flattenUpdates=function(t){var e=t.changes;if(0===e.length)return t;var r=!1;return e=e.map(function(t){return t.op===z&&0<t.entities.length?(r=!0,h.__assign({},t,{entities:t.entities.map(function(t){return t.changes})})):t}),r?h.__assign({},t,{changes:e}):t},t.prototype.restoreUpdates=function(t){var r=this;if(null==t)return t;var e=t.changes;if(0===e.length)return t;var n=!1;return e=e.map(function(t){if(t.op===z){n=!0;var e=r.getIdSelector(t.entityName);return h.__assign({},t,{entities:t.entities.map(function(t){return{id:e(t),changes:t}})})}return t}),n?h.__assign({},t,{changes:e}):t},t.prototype.getIdSelector=function(t){var e=this.idSelectors[t];return e||(e=this.entityDefinitionService.getDefinition(t).selectId,this.idSelectors[t]=e),e},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:W},{type:n.HttpClient},{type:Y,decorators:[{type:c.Optional}]}]},t}(),X=function(){function t(t){this.defaultDataServiceFactory=t,this.services={}}return t.prototype.getService=function(t){t=t.trim();var e=this.services[t];return e||(e=this.defaultDataServiceFactory.create(t),this.services[t]=e),e},t.prototype.registerService=function(t,e){this.services[t.trim()]=e},t.prototype.registerServices=function(t){this.services=h.__assign({},this.services,t)},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:K}]},t}(),Z=function(){},tt=function(){function t(t,e){this.logger=t,this.entityActionFactory=e}return t.prototype.handleSuccess=function(e){var r=this,n=k(e.payload.entityOp);return function(t){return r.entityActionFactory.createFromAction(e,{entityOp:n,data:t})}},t.prototype.handleError=function(r){var n=this,i=b(r.payload.entityOp);return function(t){var e={error:t instanceof w?t:new w(t,null),originalAction:r};return n.logger.error(e),n.entityActionFactory.createFromAction(r,{entityOp:i,data:e})}},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:P},{type:r}]},t}(),et=function(){function t(){this.seed=0,this.prefix="CRID"}return t.prototype.next=function(){return this.seed+=1,this.prefix+this.seed},t.decorators=[{type:c.Injectable}],t}(),rt=function(){function t(){this.optimisticAdd=!1,this.optimisticDelete=!0,this.optimisticUpdate=!1,this.optimisticUpsert=!1,this.optimisticSaveEntities=!1}return t.decorators=[{type:c.Injectable}],t}(),nt=function(t){this.message=t,this.message=t||"Canceled by user"},it=function(){function t(t,e,r,n){this.correlationIdGenerator=t,this.defaultDispatcherOptions=e,this.store=n,this.reducedActions$=r.pipe(d.shareReplay(1)),this.raSubscription=this.reducedActions$.subscribe()}return t.prototype.dispatch=function(t){return this.store.dispatch(t),t},t.prototype.cancelSaveEntities=function(t,e,r,n){if(!t)throw new Error("Missing correlationId");var i=new R(t,e,r,n);this.dispatch(i)},t.prototype.clearCollections=function(t,e){this.dispatch(new A(t,e))},t.prototype.loadCollections=function(t,e){this.dispatch(new C(t,e))},t.prototype.mergeQuerySet=function(t,e,r){this.dispatch(new O(t,e,r))},t.prototype.setEntityCache=function(t,e){this.dispatch(new D(t,e))},t.prototype.saveEntities=function(t,e,r){var n=Array.isArray(t)?{changes:t}:t,i=null==(r=r||{}).correlationId?this.correlationIdGenerator.next():r.correlationId,a=null==r.isOptimistic?this.defaultDispatcherOptions.optimisticSaveEntities||!1:!0===r.isOptimistic,o=r.tag||"Save Entities";r=h.__assign({},r,{correlationId:i,isOptimistic:a,tag:o});var s=new T(n,e,r);return this.dispatch(s),this.getSaveEntitiesResponseData$(r.correlationId).pipe(d.shareReplay(1))},t.prototype.getSaveEntitiesResponseData$=function(e){return this.reducedActions$.pipe(d.filter(function(t){return t.type===m.SAVE_ENTITIES_SUCCESS||t.type===m.SAVE_ENTITIES_ERROR||t.type===m.SAVE_ENTITIES_CANCEL}),d.filter(function(t){return e===t.payload.correlationId}),d.take(1),d.mergeMap(function(t){return t.type===m.SAVE_ENTITIES_CANCEL?l.throwError(new nt(t.payload.reason)):t.type===m.SAVE_ENTITIES_SUCCESS?l.of(t.payload.changeSet):l.throwError(t.payload)}))},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:et},{type:rt},{type:l.Observable,decorators:[{type:c.Inject,args:[y.ScannedActionsSubject]}]},{type:y.Store}]},t}(),at=function(){function t(e,t,r,n,i,a,o,s){void 0===n&&(n=p),this.entityName=e,this.entityActionFactory=t,this.store=r,this.selectId=n,this.defaultDispatcherOptions=i,this.reducedActions$=a,this.correlationIdGenerator=s,this.guard=new u(e,n),this.toUpdate=g(n);var c=y.createSelector(o,function(t){return t[e]});this.entityCollection$=r.select(c)}return t.prototype.createEntityAction=function(t,e,r){return this.entityActionFactory.create(h.__assign({entityName:this.entityName,entityOp:t,data:e},r))},t.prototype.createAndDispatch=function(t,e,r){var n=this.createEntityAction(t,e,r);return this.dispatch(n),n},t.prototype.dispatch=function(t){return this.store.dispatch(t),t},t.prototype.add=function(t,e){var n=this;e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticAdd);var r=this.createEntityAction(I.SAVE_ADD_ONE,t,e);return e.isOptimistic&&this.guard.mustBeEntity(r),this.dispatch(r),this.getResponseData$(e.correlationId).pipe(d.withLatestFrom(this.entityCollection$),d.map(function(t){var e=h.__read(t,2),r=e[0];return e[1].entities[n.selectId(r)]}),d.shareReplay(1))},t.prototype.cancel=function(t,e,r){if(!t)throw new Error("Missing correlationId");this.createAndDispatch(I.CANCEL_PERSIST,e,{correlationId:t})},t.prototype["delete"]=function(t,e){e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticDelete);var r=this.getKey(t),n=this.createEntityAction(I.SAVE_DELETE_ONE,r,e);return this.guard.mustBeKey(n),this.dispatch(n),this.getResponseData$(e.correlationId).pipe(d.map(function(){return r}),d.shareReplay(1))},t.prototype.getAll=function(t){var i=this;t=this.setQueryEntityActionOptions(t);var e=this.createEntityAction(I.QUERY_ALL,null,t);return this.dispatch(e),this.getResponseData$(t.correlationId).pipe(d.withLatestFrom(this.entityCollection$),d.map(function(t){var e=h.__read(t,2),r=e[0],n=e[1];return r.reduce(function(t,e){var r=n.entities[i.selectId(e)];return r&&t.push(r),t},[])}),d.shareReplay(1))},t.prototype.getByKey=function(t,e){var n=this;e=this.setQueryEntityActionOptions(e);var r=this.createEntityAction(I.QUERY_BY_KEY,t,e);return this.dispatch(r),this.getResponseData$(e.correlationId).pipe(d.withLatestFrom(this.entityCollection$),d.map(function(t){var e=h.__read(t,2),r=e[0];return e[1].entities[n.selectId(r)]}),d.shareReplay(1))},t.prototype.getWithQuery=function(t,e){var i=this;e=this.setQueryEntityActionOptions(e);var r=this.createEntityAction(I.QUERY_MANY,t,e);return this.dispatch(r),this.getResponseData$(e.correlationId).pipe(d.withLatestFrom(this.entityCollection$),d.map(function(t){var e=h.__read(t,2),r=e[0],n=e[1];return r.reduce(function(t,e){var r=n.entities[i.selectId(e)];return r&&t.push(r),t},[])}),d.shareReplay(1))},t.prototype.load=function(t){t=this.setQueryEntityActionOptions(t);var e=this.createEntityAction(I.QUERY_LOAD,null,t);return this.dispatch(e),this.getResponseData$(t.correlationId).pipe(d.shareReplay(1))},t.prototype.update=function(t,e){var n=this,r=this.toUpdate(t);e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticUpdate);var i=this.createEntityAction(I.SAVE_UPDATE_ONE,r,e);return e.isOptimistic&&this.guard.mustBeEntity(i),this.dispatch(i),this.getResponseData$(e.correlationId).pipe(d.map(function(t){return t.changes}),d.withLatestFrom(this.entityCollection$),d.map(function(t){var e=h.__read(t,2),r=e[0];return e[1].entities[n.selectId(r)]}),d.shareReplay(1))},t.prototype.upsert=function(t,e){var n=this;e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticUpsert);var r=this.createEntityAction(I.SAVE_ADD_ONE,t,e);return e.isOptimistic&&this.guard.mustBeEntity(r),this.dispatch(r),this.getResponseData$(e.correlationId).pipe(d.withLatestFrom(this.entityCollection$),d.map(function(t){var e=h.__read(t,2),r=e[0];return e[1].entities[n.selectId(r)]}),d.shareReplay(1))},t.prototype.addAllToCache=function(t,e){this.createAndDispatch(I.ADD_ALL,t,e)},t.prototype.addOneToCache=function(t,e){this.createAndDispatch(I.ADD_ONE,t,e)},t.prototype.addManyToCache=function(t,e){this.createAndDispatch(I.ADD_MANY,t,e)},t.prototype.clearCache=function(t){this.createAndDispatch(I.REMOVE_ALL,undefined,t)},t.prototype.removeOneFromCache=function(t,e){this.createAndDispatch(I.REMOVE_ONE,this.getKey(t),e)},t.prototype.removeManyFromCache=function(t,e){var r=this;if(t&&0!==t.length){var n="object"==typeof t[0]?t.map(function(t){return r.getKey(t)}):t;this.createAndDispatch(I.REMOVE_MANY,n,e)}},t.prototype.updateOneInCache=function(t,e){var r=this.toUpdate(t);this.createAndDispatch(I.UPDATE_ONE,r,e)},t.prototype.updateManyInCache=function(t,e){var r=this;if(t&&0!==t.length){var n=t.map(function(t){return r.toUpdate(t)});this.createAndDispatch(I.UPDATE_MANY,n,e)}},t.prototype.upsertOneInCache=function(t,e){this.createAndDispatch(I.UPSERT_ONE,t,e)},t.prototype.upsertManyInCache=function(t,e){t&&0!==t.length&&this.createAndDispatch(I.UPSERT_MANY,t,e)},t.prototype.setFilter=function(t){this.createAndDispatch(I.SET_FILTER,t)},t.prototype.setLoaded=function(t){this.createAndDispatch(I.SET_LOADED,!!t)},t.prototype.setLoading=function(t){this.createAndDispatch(I.SET_LOADING,!!t)},t.prototype.getKey=function(t){return"object"==typeof t?this.selectId(t):t},t.prototype.getResponseData$=function(a){var o=this;return this.reducedActions$.pipe(d.filter(function(t){return!!t.payload}),d.filter(function(t){var e=t.payload,r=e.correlationId,n=e.entityName,i=e.entityOp;return n===o.entityName&&r===a&&(i.endsWith(x)||i.endsWith(L)||i===I.CANCEL_PERSIST)}),d.take(1),d.mergeMap(function(t){var e=t.payload.entityOp;return e===I.CANCEL_PERSIST?l.throwError(new nt(t.payload.data)):e.endsWith(x)?l.of(t.payload.data):l.throwError(t.payload.data.error)}))},t.prototype.setQueryEntityActionOptions=function(t){var e=null==(t=t||{}).correlationId?this.correlationIdGenerator.next():t.correlationId;return h.__assign({},t,{correlationId:e})},t.prototype.setSaveEntityActionOptions=function(t,e){var r=null==(t=t||{}).correlationId?this.correlationIdGenerator.next():t.correlationId,n=null==t.isOptimistic?e||!1:!0===t.isOptimistic;return h.__assign({},t,{correlationId:r,isOptimistic:n})},t}(),ot="entityCache",st=new c.InjectionToken("ngrx-data/entity-cache-name"),ct=new c.InjectionToken("ngrx-data/entity-cache-meta-reducers"),ut=new c.InjectionToken("ngrx-data/entity-collection-meta-reducers"),pt=new c.InjectionToken("ngrx-data/initial-entity-cache-state"),ht=new c.InjectionToken("ngrx-data/entity-cache-selector"),yt={provide:ht,useFactory:dt,deps:[[new c.Optional,st]]};function dt(t){return t=t||ot,y.createFeatureSelector(t)}var lt=function(){function t(t,e,r,n,i,a){this.entityActionFactory=t,this.store=e,this.entityDispatcherDefaultOptions=r,this.entityCacheSelector=i,this.correlationIdGenerator=a,this.reducedActions$=n.pipe(d.shareReplay(1)),this.raSubscription=this.reducedActions$.subscribe()}return t.prototype.create=function(t,e,r){void 0===e&&(e=p),void 0===r&&(r={});var n=h.__assign({},this.entityDispatcherDefaultOptions,r);return new at(t,this.entityActionFactory,this.store,e,n,this.reducedActions$,this.entityCacheSelector,this.correlationIdGenerator)},t.prototype.ngOnDestroy=function(){this.raSubscription.unsubscribe()},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:r},{type:y.Store},{type:rt},{type:l.Observable,decorators:[{type:c.Inject,args:[y.ScannedActionsSubject]}]},{type:undefined,decorators:[{type:c.Inject,args:[ht]}]},{type:et}]},t}(),gt=new c.InjectionToken("EntityEffects Scheduler"),Et=function(){function t(t,e,r,n,i){var a=this;this.actions=t,this.dataService=e,this.entityActionFactory=r,this.logger=n,this.scheduler=i,this.responseDelay=10,this.saveEntitiesCancel$=this.actions.pipe(o.ofType(m.SAVE_ENTITIES_CANCEL),d.filter(function(t){return null!=t.payload.correlationId})),this.saveEntities$=this.actions.pipe(o.ofType(m.SAVE_ENTITIES),d.mergeMap(function(t){return a.saveEntities(t)}))}return t.prototype.saveEntities=function(e){var r=this,t=e.payload.error;if(t)return this.handleSaveEntitiesError$(e)(t);try{var n=v(e.payload.changeSet),i=e.payload,a=i.correlationId,o=i.mergeStrategy,s=i.tag,c=i.url,u={correlationId:a,mergeStrategy:o,tag:s};if(0===n.changes.length)return l.of(new U(n,c,u));var p=this.saveEntitiesCancel$.pipe(d.filter(function(t){return a===t.payload.correlationId}),d.map(function(t){return new N(a,t.payload.reason,t.payload.tag)})),h=this.dataService.saveEntities(n,c).pipe(d.concatMap(function(t){return r.handleSaveEntitiesSuccess$(e,r.entityActionFactory)(t)}),d.catchError(this.handleSaveEntitiesError$(e)));return l.race(p,h)}catch(y){return this.handleSaveEntitiesError$(e)(y)}},t.prototype.handleSaveEntitiesError$=function(r){var n=this;return function(t){var e=t instanceof w?t:new w(t,null);return l.of(new M(e,r)).pipe(d.delay(n.responseDelay,n.scheduler||l.asyncScheduler))}},t.prototype.handleSaveEntitiesSuccess$=function(r,n){var t=r.payload,i=t.url,a={correlationId:t.correlationId,mergeStrategy:t.mergeStrategy,tag:t.tag};return function(t){if(t)return l.of(new U(t,i,a));if(t=r.payload.changeSet,!r.payload.isOptimistic)return l.of(new U(t,i,a));var e=t.changes.reduce(function(t,e){return-1===t.indexOf(e.entityName)?t.concat(e.entityName):t},[]);return l.merge(e.map(function(t){return n.create(t,I.SET_LOADING,!1)}))}},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:o.Actions},{type:J},{type:r},{type:P},{type:undefined,decorators:[{type:c.Optional},{type:c.Inject,args:[gt]}]}]},h.__decorate([o.Effect({dispatch:!1}),h.__metadata("design:type",l.Observable)],t.prototype,"saveEntitiesCancel$",void 0),h.__decorate([o.Effect(),h.__metadata("design:type",l.Observable)],t.prototype,"saveEntities$",void 0),t}(),ft=[I.QUERY_ALL,I.QUERY_LOAD,I.QUERY_BY_KEY,I.QUERY_MANY,I.SAVE_ADD_ONE,I.SAVE_DELETE_ONE,I.SAVE_UPDATE_ONE,I.SAVE_UPSERT_ONE],St=function(){function t(t,e,r,n,i){var a=this;this.actions=t,this.dataService=e,this.entityActionFactory=r,this.resultHandler=n,this.scheduler=i,this.responseDelay=10,this.cancel$=this.actions.pipe(E(I.CANCEL_PERSIST),d.map(function(t){return t.payload.correlationId}),d.filter(function(t){return null!=t})),this.persist$=this.actions.pipe(E(ft),d.mergeMap(function(t){return a.persist(t)}))}return t.prototype.persist=function(e){var r=this;if(e.payload.skip)return this.handleSkipSuccess$(e);if(e.payload.error)return this.handleError$(e)(e.payload.error);try{var t=this.cancel$.pipe(d.filter(function(t){return e.payload.correlationId===t}),d.map(function(t){return r.entityActionFactory.createFromAction(e,{entityOp:I.CANCELED_PERSIST})})),n=this.callDataService(e).pipe(d.map(this.resultHandler.handleSuccess(e)),d.catchError(this.handleError$(e)));return l.race(t,n)}catch(i){return this.handleError$(e)(i)}},t.prototype.callDataService=function(t){var e=t.payload,r=e.entityName,n=e.entityOp,i=e.data,a=this.dataService.getService(r);switch(n){case I.QUERY_ALL:case I.QUERY_LOAD:return a.getAll();case I.QUERY_BY_KEY:return a.getById(i);case I.QUERY_MANY:return a.getWithQuery(i);case I.SAVE_ADD_ONE:return a.add(i);case I.SAVE_DELETE_ONE:return a["delete"](i);case I.SAVE_UPDATE_ONE:var o=i,s=o.id,c=o.changes;return a.update(i).pipe(d.map(function(t){return t&&0<Object.keys(t).length?{id:s,changes:h.__assign({},c,t),changed:!0}:{id:s,changes:c,changed:!1}}));case I.SAVE_UPSERT_ONE:return a.upsert(i).pipe(d.map(function(t){return t&&0<Object.keys(t).length?t:i}));default:throw new Error('Persistence action "'+n+'" is not implemented.')}},t.prototype.handleError$=function(e){var r=this;return function(t){return l.of(r.resultHandler.handleError(e)(t)).pipe(d.delay(r.responseDelay,r.scheduler||l.asyncScheduler))}},t.prototype.handleSkipSuccess$=function(t){var e=k(t.payload.entityOp),r=this.entityActionFactory.createFromAction(t,{entityOp:e});return l.of(r).pipe(d.delay(this.responseDelay,this.scheduler||l.asyncScheduler))},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:o.Actions},{type:X},{type:r},{type:Z},{type:undefined,decorators:[{type:c.Optional},{type:c.Inject,args:[gt]}]}]},h.__decorate([o.Effect({dispatch:!1}),h.__metadata("design:type",l.Observable)],t.prototype,"cancel$",void 0),h.__decorate([o.Effect(),h.__metadata("design:type",l.Observable)],t.prototype,"persist$",void 0),t}();var vt=function(){function t(t,e){t=(this.entityName=t).trim();var r=e.create(t),n=r.dispatcher,i=r.selectors,a=r.selectors$;this.entityName=t,this.dispatcher=n,this.guard=n.guard,this.selectId=n.selectId,this.toUpdate=n.toUpdate,this.selectors=i,this.selectors$=a,this.collection$=a.collection$,this.count$=a.count$,this.entities$=a.entities$,this.entityActions$=a.entityActions$,this.entityMap$=a.entityMap$,this.errors$=a.errors$,this.filter$=a.filter$,this.filteredEntities$=a.filteredEntities$,this.keys$=a.keys$,this.loaded$=a.loaded$,this.loading$=a.loading$,this.changeState$=a.changeState$}return t.prototype.createEntityAction=function(t,e,r){return this.dispatcher.createEntityAction(t,e,r)},t.prototype.createAndDispatch=function(t,e,r){return this.dispatcher.createAndDispatch(t,e,r)},t.prototype.dispatch=function(t){return this.dispatcher.dispatch(t)},Object.defineProperty(t.prototype,"store",{get:function(){return this.dispatcher.store},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){return this.dispatcher.add(t,e)},t.prototype.cancel=function(t,e,r){this.dispatcher.cancel(t,e,r)},t.prototype["delete"]=function(t,e){return this.dispatcher["delete"](t,e)},t.prototype.getAll=function(t){return this.dispatcher.getAll(t)},t.prototype.getByKey=function(t,e){return this.dispatcher.getByKey(t,e)},t.prototype.getWithQuery=function(t,e){return this.dispatcher.getWithQuery(t,e)},t.prototype.load=function(t){return this.dispatcher.load(t)},t.prototype.update=function(t,e){return this.dispatcher.update(t,e)},t.prototype.upsert=function(t,e){return this.dispatcher.upsert(t,e)},t.prototype.addAllToCache=function(t){this.dispatcher.addAllToCache(t)},t.prototype.addOneToCache=function(t){this.dispatcher.addOneToCache(t)},t.prototype.addManyToCache=function(t){this.dispatcher.addManyToCache(t)},t.prototype.clearCache=function(){this.dispatcher.clearCache()},t.prototype.removeOneFromCache=function(t){this.dispatcher.removeOneFromCache(t)},t.prototype.removeManyFromCache=function(t){this.dispatcher.removeManyFromCache(t)},t.prototype.updateOneInCache=function(t){this.dispatcher.updateOneInCache(t)},t.prototype.updateManyInCache=function(t){this.dispatcher.updateManyInCache(t)},t.prototype.upsertOneInCache=function(t){this.dispatcher.upsertOneInCache(t)},t.prototype.upsertManyInCache=function(t){this.dispatcher.upsertManyInCache(t)},t.prototype.setFilter=function(t){this.dispatcher.setFilter(t)},t.prototype.setLoaded=function(t){this.dispatcher.setLoaded(!!t)},t.prototype.setLoading=function(t){this.dispatcher.setLoading(!!t)},t}(),_t=function(){function t(t){this.entityDefinitionService=t}return t.prototype.create=function(t){var e=this.entityDefinitionService&&this.entityDefinitionService.getDefinition(t,!1);return e&&e.initialState||mt(t)},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:W,decorators:[{type:c.Optional}]}]},t}();function mt(t){return{entityName:t,ids:[],entities:{},filter:undefined,loaded:!1,loading:!1,changeState:{}}}var At=function(){function t(t,e){this.entityCollectionCreator=t,this.selectEntityCache=e,this.entityCollectionCreator=t||new _t,this.selectEntityCache=e||dt(ot)}return t.prototype.createCollectionSelector=function(e){var r=this;return y.createSelector(this.selectEntityCache,function(t){return void 0===t&&(t={}),t[e]||r.entityCollectionCreator.create(e)})},t.prototype.createCollectionSelectors=function(t){var e="string"==typeof t?{entityName:t}:t,r=function(t){return t.ids},n=function(t){return t.entities},i=y.createSelector(r,n,function(t,e){return t.map(function(t){return e[t]})}),a=y.createSelector(r,function(t){return t.length}),o=function(t){return t.filter},s=e.filterFn,c=s?y.createSelector(i,o,function(t,e){return s(t,e)}):i,u=e.additionalCollectionState||{},p={};return Object.keys(u).forEach(function(e){p["select"+e[0].toUpperCase()+e.slice(1)]=function(t){return t[e]}}),h.__assign({selectCount:a,selectEntities:i,selectEntityMap:n,selectFilter:o,selectFilteredEntities:c,selectKeys:r,selectLoaded:function(t){return t.loaded},selectLoading:function(t){return t.loading},selectChangeState:function(t){return t.changeState}},p)},t.prototype.create=function(t){var e="string"==typeof t?{entityName:t}:t,r=e.entityName,n=this.createCollectionSelector(r),i=this.createCollectionSelectors(e),a={};return Object.keys(i).forEach(function(t){a[t]=y.createSelector(n,i[t])}),h.__assign({entityName:r,selectCollection:n,selectEntityCache:this.selectEntityCache},a)},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:_t,decorators:[{type:c.Optional}]},{type:undefined,decorators:[{type:c.Optional},{type:c.Inject,args:[ht]}]}]},t}(),Ct=function(){function t(t,e,r){this.store=t,this.actions=e,this.selectEntityCache=r,this.entityCache$=this.store.select(this.selectEntityCache),this.entityActionErrors$=e.pipe(d.filter(function(t){return t.payload&&t.payload.entityOp&&t.payload.entityOp.endsWith(L)}),d.shareReplay(1))}return t.prototype.create=function(t,r){var n=this,i={entityName:t};return Object.keys(r).forEach(function(t){if(t.startsWith("select")){var e=t[6].toLowerCase()+t.substr(7)+"$";i[e]=n.store.select(r[t])}}),i.entityActions$=this.actions.pipe(e(t)),i.errors$=this.entityActionErrors$.pipe(e(t)),i},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:y.Store},{type:o.Actions},{type:undefined,decorators:[{type:c.Inject,args:[ht]}]}]},t}(),Ot=function(){function t(t,e,r,n){this.entityDispatcherFactory=t,this.entityDefinitionService=e,this.entitySelectorsFactory=r,this.entitySelectors$Factory=n}return t.prototype.create=function(t){t=t.trim();var e=this.entityDefinitionService.getDefinition(t),r=this.entityDispatcherFactory.create(t,e.selectId,e.entityDispatcherOptions),n=this.entitySelectorsFactory.create(e.metadata);return{dispatcher:r,entityName:t,selectors:n,selectors$:this.entitySelectors$Factory.create(t,n)}},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:lt},{type:W},{type:At},{type:Ct}]},t}(),Dt=function(){function t(t){this.entityCollectionServiceElementsFactory=t}return t.prototype.create=function(t){return new vt(t,this.entityCollectionServiceElementsFactory)},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:Ot}]},t}(),Tt=function(){function t(t,e,r,n){this.entityCollectionServiceFactory=t,this.store=n,this.entityActionErrors$=r.entityActionErrors$,this.entityCache$=r.entityCache$,this.reducedActions$=e.reducedActions$}return t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:Dt},{type:lt},{type:Ct},{type:y.Store}]},t}(),Rt=function(){function t(t){this.entityServicesElements=t,this.EntityCollectionServices={}}return Object.defineProperty(t.prototype,"entityActionErrors$",{get:function(){return this.entityServicesElements.entityActionErrors$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entityCache$",{get:function(){return this.entityServicesElements.entityCache$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entityCollectionServiceFactory",{get:function(){return this.entityServicesElements.entityCollectionServiceFactory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reducedActions$",{get:function(){return this.entityServicesElements.reducedActions$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"store",{get:function(){return this.entityServicesElements.store},enumerable:!0,configurable:!0}),t.prototype.dispatch=function(t){this.store.dispatch(t)},t.prototype.createEntityCollectionService=function(t){return this.entityCollectionServiceFactory.create(t)},t.prototype.getEntityCollectionService=function(t){var e=this.EntityCollectionServices[t];return e||(e=this.createEntityCollectionService(t),this.EntityCollectionServices[t]=e),e},t.prototype.registerEntityCollectionService=function(t,e){this.EntityCollectionServices[e||t.entityName]=t},t.prototype.registerEntityCollectionServices=function(e){var r=this;Array.isArray(e)?e.forEach(function(t){return r.registerEntityCollectionService(t)}):Object.keys(e||{}).forEach(function(t){r.registerEntityCollectionService(e[t],t)})},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:Tt}]},t}(),Nt=function(){},Mt={Unchanged:0,Added:1,Deleted:2,Updated:3};Mt[Mt.Unchanged]="Unchanged",Mt[Mt.Added]="Added",Mt[Mt.Deleted]="Deleted",Mt[Mt.Updated]="Updated";var Ut=function(){function t(t,e){this.adapter=t,this.selectId=e,this.selectId=e||p}return t.prototype.commitAll=function(t){return 0===Object.keys(t.changeState).length?t:h.__assign({},t,{changeState:{}})},t.prototype.commitMany=function(t,e){var n=this;if(null==t||0===t.length)return e;var i=!1,r=t.reduce(function(t,e){var r="object"==typeof e?n.selectId(e):e;return t[r]&&(i||(t=h.__assign({},t),i=!0),delete t[r]),t},e.changeState);return i?h.__assign({},e,{changeState:r}):e},t.prototype.commitOne=function(t,e){return null==t?e:this.commitMany([t],e)},t.prototype.mergeQueryResults=function(t,e,r){return this.mergeServerUpserts(t,e,_.PreserveChanges,r)},t.prototype.mergeSaveAdds=function(t,e,r){return this.mergeServerUpserts(t,e,_.OverwriteChanges,r)},t.prototype.mergeSaveDeletes=function(t,e,r){var n=t;return e=(r=null==r?_.OverwriteChanges:r)===_.IgnoreChanges?e:this.commitMany(n,e),this.adapter.removeMany(n,e)},t.prototype.mergeSaveUpdates=function(t,e,r,n){var o=this;if(void 0===n&&(n=!1),null==t||0===t.length)return e;var i,s=!1,a=e.changeState;switch(r=null==r?_.OverwriteChanges:r){case _.IgnoreChanges:return i=u(t),this.adapter.updateMany(i,e);case _.OverwriteChanges:return a=t.reduce(function(t,e){var r=e.id;return t[r]&&(s||(t=h.__assign({},t),s=!0),delete t[r]),t},e.changeState),e=s?h.__assign({},e,{changeState:a}):e,i=u(t),this.adapter.updateMany(i,e);case _.PreserveChanges:var c=[];return a=t.reduce(function(t,e){var r=e.id;if(t[r]){s||(t=h.__assign({},t),s=!0);var n=o.selectId(e.changes),i=t[r];n!==r&&delete t[r];var a=h.__assign({},i.originalValue,e.changes);t[n]=h.__assign({},i,{originalValue:a})}else c.push(e);return t},e.changeState),e=s?h.__assign({},e,{changeState:a}):e,i=u(c),this.adapter.updateMany(i,e)}function u(t){return!0===n&&(t=t.filter(function(t){return!0===t.changed})),t.map(function(t){return{id:t.id,changes:t.changes}})}},t.prototype.mergeSaveUpserts=function(t,e,r){return this.mergeServerUpserts(t,e,_.OverwriteChanges,r)},t.prototype.mergeServerUpserts=function(t,e,r,n){var i=this;if(null==t||0===t.length)return e;var a=!1,o=e.changeState;switch(n=null==n?r:n){case _.IgnoreChanges:return this.adapter.upsertMany(t,e);case _.OverwriteChanges:return e=this.adapter.upsertMany(t,e),o=t.reduce(function(t,e){var r=i.selectId(e);return t[r]&&(a||(t=h.__assign({},t),a=!0),delete t[r]),t},e.changeState),a?h.__assign({},e,{changeState:o}):e;case _.PreserveChanges:var s=[];return o=t.reduce(function(t,e){var r=i.selectId(e);return t[r]?(a||(t=h.__assign({},t),a=!0),t[r].originalValue=e):s.push(e),t},e.changeState),e=this.adapter.upsertMany(s,e),a?h.__assign({},e,{changeState:o}):e}},t.prototype.trackAddMany=function(t,n,e){var i=this;if(e===_.IgnoreChanges||null==t||0===t.length)return n;var a=!1,r=t.reduce(function(t,e){var r=i.selectId(e);if(null==r||""===r)throw new Error(n.entityName+" entity add requires a key to be tracked");return t[r]||(a||(a=!0,t=h.__assign({},t)),t[r]={changeType:Mt.Added}),t},n.changeState);return a?h.__assign({},n,{changeState:r}):n},t.prototype.trackAddOne=function(t,e,r){return null==t?e:this.trackAddMany([t],e,r)},t.prototype.trackDeleteMany=function(t,e,r){if(r===_.IgnoreChanges||null==t||0===t.length)return e;var a=!1,o=e.entities,n=t.reduce(function(t,e){var r=o[e];if(r){var n=t[e];n?n.changeType===Mt.Added?(i(),delete t[e]):n.changeType===Mt.Updated&&(i(),t[e].changeType=Mt.Deleted):(i(),t[e]={changeType:Mt.Deleted,originalValue:r})}return t;function i(){a||(a=!0,t=h.__assign({},t))}},e.changeState);return a?h.__assign({},e,{changeState:n}):e},t.prototype.trackDeleteOne=function(t,e,r){return null==t?e:this.trackDeleteMany([t],e,r)},t.prototype.trackUpdateMany=function(t,i,e){if(e===_.IgnoreChanges||null==t||0===t.length)return i;var a=!1,o=i.entities,r=t.reduce(function(t,e){var r=e.id;e.changes;if(null==r||""===r)throw new Error(i.entityName+" entity update requires a key to be tracked");var n=o[r];n&&(t[r]||(a||(a=!0,t=h.__assign({},t)),t[r]={changeType:Mt.Updated,originalValue:n}));return t},i.changeState);return a?h.__assign({},i,{changeState:r}):i},t.prototype.trackUpdateOne=function(t,e,r){return null==t?e:this.trackUpdateMany([t],e,r)},t.prototype.trackUpsertMany=function(t,i,e){var a=this;if(e===_.IgnoreChanges||null==t||0===t.length)return i;var o=!1,s=i.entities,r=t.reduce(function(t,e){var r=a.selectId(e);if(null==r||""===r)throw new Error(i.entityName+" entity upsert requires a key to be tracked");if(!t[r]){o||(o=!0,t=h.__assign({},t));var n=s[r];t[r]=null==n?{changeType:Mt.Added}:{changeType:Mt.Updated,originalValue:n}}return t},i.changeState);return o?h.__assign({},i,{changeState:r}):i},t.prototype.trackUpsertOne=function(t,e,r){return null==t?e:this.trackUpsertMany([t],e,r)},t.prototype.undoAll=function(t){var e=Object.keys(t.changeState).reduce(function(t,e){var r=t.chgState[e];switch(r.changeType){case Mt.Added:t.remove.push(e);break;case Mt.Deleted:var n=r.originalValue;n&&t.upsert.push(n);break;case Mt.Updated:t.upsert.push(r.originalValue)}return t},{remove:[],upsert:[],chgState:t.changeState}),r=e.remove,n=e.upsert;return t=this.adapter.removeMany(r,t),t=this.adapter.upsertMany(n,t),h.__assign({},t,{changeState:{}})},t.prototype.undoMany=function(t,e){var o=this;if(null==t||0===t.length)return e;var s=!1,r=t.reduce(function(t,e){var r=t.changeState,n="object"==typeof e?o.selectId(e):e;if(r[n]){s||(r=h.__assign({},r),s=!0);var i=r[n];switch(delete r[n],i.changeType){case Mt.Added:t.remove.push(n);break;case Mt.Deleted:var a=i.originalValue;a&&t.upsert.push(a);break;case Mt.Updated:t.upsert.push(i.originalValue)}}return t},{remove:[],upsert:[],changeState:e.changeState}),n=r.changeState,i=r.remove,a=r.upsert;return e=this.adapter.removeMany(i,e),e=this.adapter.upsertMany(a,e),s?e:h.__assign({},e,{changeState:n})},t.prototype.undoOne=function(t,e){return null==t?e:this.undoMany([t],e)},t}(),It=function(){function t(t,e,r){var n;this.entityName=t,this.definition=e,this.entityChangeTracker=r,this.methods=((n={})[I.CANCEL_PERSIST]=this.cancelPersist.bind(this),n[I.QUERY_ALL]=this.queryAll.bind(this),n[I.QUERY_ALL_ERROR]=this.queryAllError.bind(this),n[I.QUERY_ALL_SUCCESS]=this.queryAllSuccess.bind(this),n[I.QUERY_BY_KEY]=this.queryByKey.bind(this),n[I.QUERY_BY_KEY_ERROR]=this.queryByKeyError.bind(this),n[I.QUERY_BY_KEY_SUCCESS]=this.queryByKeySuccess.bind(this),n[I.QUERY_LOAD]=this.queryLoad.bind(this),n[I.QUERY_LOAD_ERROR]=this.queryLoadError.bind(this),n[I.QUERY_LOAD_SUCCESS]=this.queryLoadSuccess.bind(this),n[I.QUERY_MANY]=this.queryMany.bind(this),n[I.QUERY_MANY_ERROR]=this.queryManyError.bind(this),n[I.QUERY_MANY_SUCCESS]=this.queryManySuccess.bind(this),n[I.SAVE_ADD_MANY]=this.saveAddMany.bind(this),n[I.SAVE_ADD_MANY_ERROR]=this.saveAddManyError.bind(this),n[I.SAVE_ADD_MANY_SUCCESS]=this.saveAddManySuccess.bind(this),n[I.SAVE_ADD_ONE]=this.saveAddOne.bind(this),n[I.SAVE_ADD_ONE_ERROR]=this.saveAddOneError.bind(this),n[I.SAVE_ADD_ONE_SUCCESS]=this.saveAddOneSuccess.bind(this),n[I.SAVE_DELETE_MANY]=this.saveDeleteMany.bind(this),n[I.SAVE_DELETE_MANY_ERROR]=this.saveDeleteManyError.bind(this),n[I.SAVE_DELETE_MANY_SUCCESS]=this.saveDeleteManySuccess.bind(this),n[I.SAVE_DELETE_ONE]=this.saveDeleteOne.bind(this),n[I.SAVE_DELETE_ONE_ERROR]=this.saveDeleteOneError.bind(this),n[I.SAVE_DELETE_ONE_SUCCESS]=this.saveDeleteOneSuccess.bind(this),n[I.SAVE_UPDATE_MANY]=this.saveUpdateMany.bind(this),n[I.SAVE_UPDATE_MANY_ERROR]=this.saveUpdateManyError.bind(this),n[I.SAVE_UPDATE_MANY_SUCCESS]=this.saveUpdateManySuccess.bind(this),n[I.SAVE_UPDATE_ONE]=this.saveUpdateOne.bind(this),n[I.SAVE_UPDATE_ONE_ERROR]=this.saveUpdateOneError.bind(this),n[I.SAVE_UPDATE_ONE_SUCCESS]=this.saveUpdateOneSuccess.bind(this),n[I.SAVE_UPSERT_MANY]=this.saveUpsertMany.bind(this),n[I.SAVE_UPSERT_MANY_ERROR]=this.saveUpsertManyError.bind(this),n[I.SAVE_UPSERT_MANY_SUCCESS]=this.saveUpsertManySuccess.bind(this),n[I.SAVE_UPSERT_ONE]=this.saveUpsertOne.bind(this),n[I.SAVE_UPSERT_ONE_ERROR]=this.saveUpsertOneError.bind(this),n[I.SAVE_UPSERT_ONE_SUCCESS]=this.saveUpsertOneSuccess.bind(this),n[I.ADD_ALL]=this.addAll.bind(this),n[I.ADD_MANY]=this.addMany.bind(this),n[I.ADD_ONE]=this.addOne.bind(this),n[I.REMOVE_ALL]=this.removeAll.bind(this),n[I.REMOVE_MANY]=this.removeMany.bind(this),n[I.REMOVE_ONE]=this.removeOne.bind(this),n[I.UPDATE_MANY]=this.updateMany.bind(this),n[I.UPDATE_ONE]=this.updateOne.bind(this),n[I.UPSERT_MANY]=this.upsertMany.bind(this),n[I.UPSERT_ONE]=this.upsertOne.bind(this),n[I.COMMIT_ALL]=this.commitAll.bind(this),n[I.COMMIT_MANY]=this.commitMany.bind(this),n[I.COMMIT_ONE]=this.commitOne.bind(this),n[I.UNDO_ALL]=this.undoAll.bind(this),n[I.UNDO_MANY]=this.undoMany.bind(this),n[I.UNDO_ONE]=this.undoOne.bind(this),n[I.SET_CHANGE_STATE]=this.setChangeState.bind(this),n[I.SET_COLLECTION]=this.setCollection.bind(this),n[I.SET_FILTER]=this.setFilter.bind(this),n[I.SET_LOADED]=this.setLoaded.bind(this),n[I.SET_LOADING]=this.setLoading.bind(this),n),this.adapter=e.entityAdapter,this.isChangeTracking=!0!==e.noChangeTracking,this.selectId=e.selectId,this.guard=new u(t,this.selectId),this.toUpdate=g(this.selectId),r||(this.entityChangeTracker=new Ut(this.adapter,this.selectId))}return t.prototype.cancelPersist=function(t){return this.setLoadingFalse(t)},t.prototype.queryAll=function(t){return this.setLoadingTrue(t)},t.prototype.queryAllError=function(t,e){return this.setLoadingFalse(t)},t.prototype.queryAllSuccess=function(t,e){var r=this.extractData(e),n=this.extractMergeStrategy(e);return h.__assign({},this.entityChangeTracker.mergeQueryResults(r,t,n),{loaded:!0,loading:!1})},t.prototype.queryByKey=function(t,e){return this.setLoadingTrue(t)},t.prototype.queryByKeyError=function(t,e){return this.setLoadingFalse(t)},t.prototype.queryByKeySuccess=function(t,e){var r=this.extractData(e),n=this.extractMergeStrategy(e);return t=null==r?t:this.entityChangeTracker.mergeQueryResults([r],t,n),this.setLoadingFalse(t)},t.prototype.queryLoad=function(t){return this.setLoadingTrue(t)},t.prototype.queryLoadError=function(t,e){return this.setLoadingFalse(t)},t.prototype.queryLoadSuccess=function(t,e){var r=this.extractData(e);return h.__assign({},this.adapter.addAll(r,t),{loading:!1,loaded:!0,changeState:{}})},t.prototype.queryMany=function(t,e){return this.setLoadingTrue(t)},t.prototype.queryManyError=function(t,e){return this.setLoadingFalse(t)},t.prototype.queryManySuccess=function(t,e){var r=this.extractData(e),n=this.extractMergeStrategy(e);return h.__assign({},this.entityChangeTracker.mergeQueryResults(r,t,n),{loading:!1})},t.prototype.saveAddMany=function(t,e){if(this.isOptimistic(e)){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackAddMany(r,t,n),t=this.adapter.addMany(r,t)}return this.setLoadingTrue(t)},t.prototype.saveAddManyError=function(t,e){return this.setLoadingFalse(t)},t.prototype.saveAddManySuccess=function(t,e){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);return t=this.isOptimistic(e)?this.entityChangeTracker.mergeSaveUpserts(r,t,n):this.entityChangeTracker.mergeSaveAdds(r,t,n),this.setLoadingFalse(t)},t.prototype.saveAddOne=function(t,e){if(this.isOptimistic(e)){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackAddOne(r,t,n),t=this.adapter.addOne(r,t)}return this.setLoadingTrue(t)},t.prototype.saveAddOneError=function(t,e){return this.setLoadingFalse(t)},t.prototype.saveAddOneSuccess=function(t,e){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);if(this.isOptimistic(e)){var i=this.toUpdate(r);t=this.entityChangeTracker.mergeSaveUpdates([i],t,n,!1)}else t=this.entityChangeTracker.mergeSaveAdds([r],t,n);return this.setLoadingFalse(t)},t.prototype.saveDeleteOne=function(t,e){var r=this.extractData(e),n="object"==typeof r?this.selectId(r):r,i=t.changeState[n];if(i&&(i.changeType===Mt.Added?(t=this.adapter.removeOne(n,t),t=this.entityChangeTracker.commitOne(n,t),e.payload.skip=!0):t=this.entityChangeTracker.trackDeleteOne(n,t)),this.isOptimistic(e)){var a=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackDeleteOne(n,t,a),t=this.adapter.removeOne(n,t)}return this.setLoadingTrue(t)},t.prototype.saveDeleteOneError=function(t,e){return this.setLoadingFalse(t)},t.prototype.saveDeleteOneSuccess=function(t,e){var r=this.extractData(e);if(this.isOptimistic(e)){var n=this.extractMergeStrategy(e);t=this.entityChangeTracker.mergeSaveDeletes([r],t,n)}else t=this.adapter.removeOne(r,t),t=this.entityChangeTracker.commitOne(r,t);return this.setLoadingFalse(t)},t.prototype.saveDeleteMany=function(r,n){var i=this,t=this.extractData(n).map(function(t){return"object"==typeof t?i.selectId(t):t});if(t.forEach(function(t){var e=r.changeState[t];e&&(e.changeType===Mt.Added?(r=i.adapter.removeOne(t,r),r=i.entityChangeTracker.commitOne(t,r),n.payload.skip=!0):r=i.entityChangeTracker.trackDeleteOne(t,r))}),this.isOptimistic(n)){var e=this.extractMergeStrategy(n);r=this.entityChangeTracker.trackDeleteMany(t,r,e),r=this.adapter.removeMany(t,r)}return this.setLoadingTrue(r)},t.prototype.saveDeleteManyError=function(t,e){return this.setLoadingFalse(t)},t.prototype.saveDeleteManySuccess=function(t,e){var r=this.extractData(e);if(this.isOptimistic(e)){var n=this.extractMergeStrategy(e);t=this.entityChangeTracker.mergeSaveDeletes(r,t,n)}else t=this.adapter.removeMany(r,t),t=this.entityChangeTracker.commitMany(r,t);return this.setLoadingFalse(t)},t.prototype.saveUpdateOne=function(t,e){var r=this.guard.mustBeUpdate(e);if(this.isOptimistic(e)){var n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpdateOne(r,t,n),t=this.adapter.updateOne(r,t)}return this.setLoadingTrue(t)},t.prototype.saveUpdateOneError=function(t,e){return this.setLoadingFalse(t)},t.prototype.saveUpdateOneSuccess=function(t,e){var r=this.guard.mustBeUpdateResponse(e),n=this.isOptimistic(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.mergeSaveUpdates([r],t,i,n),this.setLoadingFalse(t)},t.prototype.saveUpdateMany=function(t,e){var r=this.guard.mustBeUpdates(e);if(this.isOptimistic(e)){var n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpdateMany(r,t,n),t=this.adapter.updateMany(r,t)}return this.setLoadingTrue(t)},t.prototype.saveUpdateManyError=function(t,e){return this.setLoadingFalse(t)},t.prototype.saveUpdateManySuccess=function(t,e){var r=this.guard.mustBeUpdateResponses(e),n=(this.isOptimistic(e),this.extractMergeStrategy(e));return t=this.entityChangeTracker.mergeSaveUpdates(r,t,n,!1),this.setLoadingFalse(t)},t.prototype.saveUpsertOne=function(t,e){if(this.isOptimistic(e)){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpsertOne(r,t,n),t=this.adapter.upsertOne(r,t)}return this.setLoadingTrue(t)},t.prototype.saveUpsertOneError=function(t,e){return this.setLoadingFalse(t)},t.prototype.saveUpsertOneSuccess=function(t,e){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.mergeSaveUpserts([r],t,n),this.setLoadingFalse(t)},t.prototype.saveUpsertMany=function(t,e){if(this.isOptimistic(e)){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpsertMany(r,t,n),t=this.adapter.upsertMany(r,t)}return this.setLoadingTrue(t)},t.prototype.saveUpsertManyError=function(t,e){return this.setLoadingFalse(t)},t.prototype.saveUpsertManySuccess=function(t,e){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.mergeSaveUpserts(r,t,n),this.setLoadingFalse(t)},t.prototype.addAll=function(t,e){var r=this.guard.mustBeEntities(e);return h.__assign({},this.adapter.addAll(r,t),{loading:!1,loaded:!0,changeState:{}})},t.prototype.addMany=function(t,e){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackAddMany(r,t,n),this.adapter.addMany(r,t)},t.prototype.addOne=function(t,e){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackAddOne(r,t,n),this.adapter.addOne(r,t)},t.prototype.removeMany=function(t,e){var r=this.guard.mustBeKeys(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackDeleteMany(r,t,n),this.adapter.removeMany(r,t)},t.prototype.removeOne=function(t,e){var r=this.guard.mustBeKey(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackDeleteOne(r,t,n),this.adapter.removeOne(r,t)},t.prototype.removeAll=function(t,e){return h.__assign({},this.adapter.removeAll(t),{loaded:!1,loading:!1,changeState:{}})},t.prototype.updateMany=function(t,e){var r=this.guard.mustBeUpdates(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpdateMany(r,t,n),this.adapter.updateMany(r,t)},t.prototype.updateOne=function(t,e){var r=this.guard.mustBeUpdate(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpdateOne(r,t,n),this.adapter.updateOne(r,t)},t.prototype.upsertMany=function(t,e){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpsertMany(r,t,n),this.adapter.upsertMany(r,t)},t.prototype.upsertOne=function(t,e){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpsertOne(r,t,n),this.adapter.upsertOne(r,t)},t.prototype.commitAll=function(t){return this.entityChangeTracker.commitAll(t)},t.prototype.commitMany=function(t,e){return this.entityChangeTracker.commitMany(this.extractData(e),t)},t.prototype.commitOne=function(t,e){return this.entityChangeTracker.commitOne(this.extractData(e),t)},t.prototype.undoAll=function(t){return this.entityChangeTracker.undoAll(t)},t.prototype.undoMany=function(t,e){return this.entityChangeTracker.undoMany(this.extractData(e),t)},t.prototype.undoOne=function(t,e){return this.entityChangeTracker.undoOne(this.extractData(e),t)},t.prototype.setChangeState=function(t,e){var r=this.extractData(e);return t.changeState===r?t:h.__assign({},t,{changeState:r})},t.prototype.setCollection=function(t,e){var r=this.extractData(e);return t===r?t:r},t.prototype.setFilter=function(t,e){var r=this.extractData(e);return t.filter===r?t:h.__assign({},t,{filter:r})},t.prototype.setLoaded=function(t,e){var r=!0===this.extractData(e)||!1;return t.loaded===r?t:h.__assign({},t,{loaded:r})},t.prototype.setLoading=function(t,e){return this.setLoadingFlag(t,this.extractData(e))},t.prototype.setLoadingFalse=function(t){return this.setLoadingFlag(t,!1)},t.prototype.setLoadingTrue=function(t){return this.setLoadingFlag(t,!0)},t.prototype.setLoadingFlag=function(t,e){return e=!0===e,t.loading===e?t:h.__assign({},t,{loading:e})},t.prototype.extractData=function(t){return t.payload&&t.payload.data},t.prototype.extractMergeStrategy=function(t){return this.isChangeTracking?t.payload&&t.payload.mergeStrategy:_.IgnoreChanges},t.prototype.isOptimistic=function(t){return t.payload&&!0===t.payload.isOptimistic},t}(),xt=function(){function t(t){this.entityDefinitionService=t}return t.prototype.create=function(t){var e=this.entityDefinitionService.getDefinition(t);return new It(t,e).methods},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:W}]},t}(),Lt=function(){function t(t){this.methodsFactory=t}return t.prototype.create=function(t){var n=this.methodsFactory.create(t);return function(t,e){var r=n[e.payload.entityOp];return r?r(t,e):t}},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:xt}]},t}(),bt=function(){function t(t,e){this.entityCollectionReducerFactory=t,this.entityCollectionReducers={},this.entityCollectionMetaReducer=y.compose.apply(null,e||[])}return t.prototype.getOrCreateReducer=function(t){var e=this.entityCollectionReducers[t];return e||(e=this.entityCollectionReducerFactory.create(t),e=this.registerReducer(t,e),this.entityCollectionReducers[t]=e),e},t.prototype.registerReducer=function(t,e){return e=this.entityCollectionMetaReducer(e),this.entityCollectionReducers[t.trim()]=e},t.prototype.registerReducers=function(e){var r=this;(e?Object.keys(e):[]).forEach(function(t){return r.registerReducer(t,e[t])})},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:Lt},{type:Array,decorators:[{type:c.Optional},{type:c.Inject,args:[ut]}]}]},t}(),kt=function(){function t(t,e,r){this.entityCollectionCreator=t,this.entityCollectionReducerRegistry=e,this.logger=r}return t.prototype.create=function(){return function(t,e){void 0===t&&(t={});switch(e.type){case m.CLEAR_COLLECTIONS:return this.clearCollectionsReducer(t,e);case m.LOAD_COLLECTIONS:return this.loadCollectionsReducer(t,e);case m.MERGE_QUERY_SET:return this.mergeQuerySetReducer(t,e);case m.SAVE_ENTITIES:return this.saveEntitiesReducer(t,e);case m.SAVE_ENTITIES_CANCEL:return this.saveEntitiesCancelReducer(t,e);case m.SAVE_ENTITIES_ERROR:return this.saveEntitiesErrorReducer(t,e);case m.SAVE_ENTITIES_SUCCESS:return this.saveEntitiesSuccessReducer(t,e);case m.SET_ENTITY_CACHE:return e.payload.cache}var r=e.payload;if(r&&r.entityName&&r.entityOp&&!r.error)return this.applyCollectionReducer(t,e);return t}.bind(this)},t.prototype.clearCollectionsReducer=function(t,i){var a=this,e=i.payload,r=e.collections,o=(e.tag,I.REMOVE_ALL);return r||(r=Object.keys(t)),t=r.reduce(function(t,e){var r={entityName:e,entityOp:o},n={type:"["+e+"] "+i.type,payload:r};return t=a.applyCollectionReducer(t,n)},t)},t.prototype.loadCollectionsReducer=function(t,i){var a=this,e=i.payload,o=e.collections,s=(e.tag,I.ADD_ALL);return t=Object.keys(o).reduce(function(t,e){var r={entityName:e,entityOp:s,data:o[e]},n={type:"["+e+"] "+i.type,payload:r};return t=a.applyCollectionReducer(t,n)},t)},t.prototype.mergeQuerySetReducer=function(t,i){var a=this,e=i.payload,o=e.mergeStrategy,s=e.querySet;e.tag;o=null===o?_.PreserveChanges:o;var c=I.UPSERT_MANY;return t=Object.keys(s).reduce(function(t,e){var r={entityName:e,entityOp:c,data:s[e],mergeStrategy:o},n={type:"["+e+"] "+i.type,payload:r};return t=a.applyCollectionReducer(t,n)},t)},t.prototype.saveEntitiesReducer=function(i,a){var o=this,t=a.payload,e=t.changeSet,s=t.correlationId,c=t.isOptimistic,u=t.mergeStrategy,p=t.tag;try{e.changes.forEach(function(t){var e=t.entityName,r={entityName:e,entityOp:function(t){switch(t.op){case f.Add:return I.SAVE_ADD_MANY;case f.Delete:return I.SAVE_DELETE_MANY;case f.Update:return I.SAVE_UPDATE_MANY;case f.Upsert:return I.SAVE_UPSERT_MANY}}(t),data:t.entities,correlationId:s,isOptimistic:c,mergeStrategy:u,tag:p},n={type:"["+e+"] "+a.type,payload:r};if(i=o.applyCollectionReducer(i,n),n.payload.error)throw n.payload.error})}catch(r){a.payload.error=r}return i},t.prototype.saveEntitiesCancelReducer=function(t,e){return this.clearLoadingFlags(t,e.payload.entityNames||[])},t.prototype.saveEntitiesErrorReducer=function(t,e){var r=e.payload.originalAction.payload.changeSet.changes.map(function(t){return t.entityName});return this.clearLoadingFlags(t,r)},t.prototype.saveEntitiesSuccessReducer=function(i,a){var o=this,t=a.payload,e=t.changeSet,s=t.correlationId,c=t.isOptimistic,u=t.mergeStrategy,p=t.tag;return e.changes.forEach(function(t){var e=t.entityName,r={entityName:e,entityOp:function(t){switch(t.op){case f.Add:return I.SAVE_ADD_MANY_SUCCESS;case f.Delete:return I.SAVE_DELETE_MANY_SUCCESS;case f.Update:return I.SAVE_UPDATE_MANY_SUCCESS;case f.Upsert:return I.SAVE_UPSERT_MANY_SUCCESS}}(t),data:t.entities,correlationId:s,isOptimistic:c,mergeStrategy:u,tag:p},n={type:"["+e+"] "+a.type,payload:r};i=o.applyCollectionReducer(i,n)}),i},t.prototype.applyCollectionReducer=function(t,e){void 0===t&&(t={});var r,n,i=e.payload.entityName,a=t[i],o=this.entityCollectionReducerRegistry.getOrCreateReducer(i);try{r=o(a||this.entityCollectionCreator.create(i),e)}catch(s){this.logger.error(s),e.payload.error=s}return e.payload.error||a===r?t:h.__assign({},t,((n={})[i]=r,n))},t.prototype.clearLoadingFlags=function(r,t){var n=!1;return t.forEach(function(t){var e=r[t];e.loading&&(n||(r=h.__assign({},r),n=!0),r[t]=h.__assign({},e,{loading:!1}))}),r},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:_t},{type:bt},{type:P}]},t}(),wt=function(){function t(){}return t.prototype.error=function(t,e){t&&(e?console.error(t,e):console.error(t))},t.prototype.log=function(t,e){t&&(e?console.log(t,e):console.log(t))},t.prototype.warn=function(t,e){t&&(e?console.warn(t,e):console.warn(t))},t.decorators=[{type:c.Injectable}],t}(),Yt=["equipment","information","money","series"],Pt=function(){function t(t){var e=this;this.pluralNames={},t&&t.forEach(function(t){return e.registerPluralNames(t)})}return t.prototype.pluralize=function(t){var e=this.pluralNames[t];return e||(0<=Yt.indexOf(t.toLowerCase())?t:/[aeiou]y$/.test(t)?t+"s":t.endsWith("y")?t.substr(0,t.length-1)+"ies":/[s|ss|sh|ch|x|z]$/.test(t)?t+"es":t+"s")},t.prototype.registerPluralNames=function(t){this.pluralNames=h.__assign({},this.pluralNames,t||{})},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:Array,decorators:[{type:c.Optional},{type:c.Inject,args:[V]}]}]},t}();function Vt(){return"xxxxxxxxxx4xxyxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}var Ft=function(){},$t=ot,jt=function(){function e(t,e,r,n,i,a){this.reducerManager=t,this.injector=r,this.entityCacheName=n,this.initialState=i,this.metaReducers=a;var o=n||ot;i="function"==typeof i?i():i;var s=(a||[]).map(function(t){return t instanceof c.InjectionToken?r.get(t):t});this.entityCacheFeature={key:o,reducers:e.create(),reducerFactory:y.combineReducers,initialState:i||{},metaReducers:s},t.addFeature(this.entityCacheFeature)}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:ct,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:ut,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:V,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}},e.prototype.ngOnDestroy=function(){this.reducerManager.removeFeature(this.entityCacheFeature)},e.decorators=[{type:c.NgModule,args:[{imports:[y.StoreModule],providers:[et,rt,r,it,kt,yt,_t,Lt,xt,bt,Ot,Dt,W,lt,At,Ct,Tt,{provide:st,useValue:$t},{provide:Nt,useClass:Rt},{provide:P,useClass:wt}]}]}],e.ctorParameters=function(){return[{type:y.ReducerManager},{type:kt},{type:c.Injector},{type:String,decorators:[{type:c.Optional},{type:c.Inject,args:[st]}]},{type:undefined,decorators:[{type:c.Optional},{type:c.Inject,args:[pt]}]},{type:Array,decorators:[{type:c.Optional},{type:c.Inject,args:[ct]}]}]},e}(),Bt=function(){function e(t,e,r){this.effectSources=t,this.addEffects(e),this.addEffects(r)}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:G,multi:!0,useValue:t.entityMetadata?t.entityMetadata:[]},{provide:ct,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:ut,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:V,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}},e.prototype.addEffects=function(t){this.effectSources.addEffects(t)},e.decorators=[{type:c.NgModule,args:[{imports:[jt,o.EffectsModule],providers:[K,J,X,Et,St,{provide:j,useClass:B},{provide:Z,useClass:tt},{provide:F,useClass:Pt}]}]}],e.ctorParameters=function(){return[{type:o.EffectSources},{type:Et},{type:St}]},e}();t.NgrxDataModule=Bt,t.NgrxDataModuleWithoutEffects=jt,t.EntityActionFactory=r,t.EntityActionGuard=u,t.ofEntityOp=E,t.ofEntityType=e,t.ChangeSetOperation=f,t.EntityCacheAction=m,t.ClearCollections=A,t.LoadCollections=C,t.MergeQuerySet=O,t.SetEntityCache=D,t.SaveEntities=T,t.SaveEntitiesCancel=R,t.SaveEntitiesCanceled=N,t.SaveEntitiesError=M,t.SaveEntitiesSuccess=U,t.ChangeSetItemFactory=a,t.changeSetItemFactory=S,t.excludeEmptyChangeSetItems=v,t.EntityOp=I,t.OP_SUCCESS=x,t.OP_ERROR=L,t.makeErrorOp=b,t.makeSuccessOp=k,t.MergeStrategy=_,t.DataServiceError=w,t.DefaultDataServiceConfig=Y,t.DefaultDataService=q,t.DefaultDataServiceFactory=K,t.EntityCacheDataService=J,t.EntityDataService=X,t.EntityHttpResourceUrls=$,t.HttpUrlGenerator=j,t.DefaultHttpUrlGenerator=B,t.normalizeRoot=Q,t.PersistenceResultHandler=Z,t.DefaultPersistenceResultHandler=tt,t.EntityCacheDispatcher=it,t.EntityDispatcherBase=at,t.EntityDispatcherDefaultOptions=rt,t.EntityDispatcherFactory=lt,t.PersistanceCanceled=nt,t.EntityCacheEffects=Et,t.persistOps=ft,t.EntityEffects=St,t.EntityDefinitionService=W,t.createEntityDefinition=H,t.PropsFilterFnFactory=function(n){return void 0===n&&(n=[]),0===n.length?function(t,e){return t}:function(t,e){if(!t)return[];var r="string"==typeof e?new RegExp(e,"i"):e;return r?t.filter(function(e){return n.some(function(t){return r.test(e[t])})}):t}},t.ENTITY_METADATA_TOKEN=G,t.EntityCollectionServiceBase=vt,t.EntityCollectionServiceElementsFactory=Ot,t.EntityCollectionServiceFactory=Dt,t.EntityServicesBase=Rt,t.EntityServicesElements=Tt,t.EntityServices=Nt,t.ENTITY_CACHE_NAME=ot,t.ENTITY_CACHE_NAME_TOKEN=st,t.ENTITY_CACHE_META_REDUCERS=ct,t.ENTITY_COLLECTION_META_REDUCERS=ut,t.INITIAL_ENTITY_CACHE_STATE=pt,t.EntityCacheReducerFactory=kt,t.EntityChangeTrackerBase=Ut,t.EntityCollectionCreator=_t,t.createEmptyEntityCollection=mt,t.EntityCollectionReducerMethods=It,t.EntityCollectionReducerMethodsFactory=xt,t.EntityCollectionReducerRegistry=bt,t.EntityCollectionReducerFactory=Lt,t.ChangeType=Mt,t.ENTITY_CACHE_SELECTOR_TOKEN=ht,t.entityCacheSelectorProvider=yt,t.createEntityCacheSelector=dt,t.EntitySelectorsFactory=At,t.EntitySelectors$Factory=Ct,t.CorrelationIdGenerator=et,t.DefaultLogger=wt,t.DefaultPluralizer=Pt,t.getUuid=Vt,t.getGuid=function(){return Vt()},t.getGuidComb=function(t){var e=("00"+(t||(new Date).getTime()).toString(16)).slice(-12);return"xxxxxxxxxx4xxyxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})+e},t.guidComparer=function(t,e){var r=t.slice(-12),n=e.slice(-12);return r!==n?r<n?-1:+(r!==n):t<e?-1:+(t!==e)},t.Logger=P,t.PLURAL_NAMES_TOKEN=V,t.Pluralizer=F,t.Dictionary=Ft,t.defaultSelectId=p,t.flattenArgs=i,t.toUpdateFactory=g,t.ɵa=gt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngrx-data.umd.min.js.map